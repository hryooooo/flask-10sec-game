ã‚ãªãŸ:
import gevent
from flask import Flask, render_template, request
from flask_socketio import SocketIO, emit, join_room
import time

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*", async_mode="gevent")

start_time = None  # ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹æ™‚é–“
results = {}

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/admin')
def admin():
    return render_template('admin.html')

@socketio.on('start_timer')
def start_timer():
    global start_time, results
    print("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡")
    start_time = int(time.time() * 1000)  # ç§’â†’ãƒŸãƒªç§’ã«å¤‰æ›
    results = {}  # ãƒªã‚»ãƒƒãƒˆ
    emit('timer_started', start_time, broadcast=True)  # ãƒŸãƒªç§’å˜ä½ã§é€ä¿¡

@socketio.on('submit_time')
def submit_time(data):
    user = data['user']
    press_time = data['time']

    # å°æ•°ç‚¹ä»¥ä¸‹3æ¡ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    formatted_time = float("{:.3f}".format(press_time))
    results[user] = formatted_time

    # adminã«çµæœã‚’é€ä¿¡
    emit('update_results', results, room="admin_room")

@socketio.on('connect')
def handle_connect():
    # ç®¡ç†è€…ãŒæ¥ç¶šã—ãŸæ™‚ã« admin_room ã«å‚åŠ 
    join_room("admin_room")
    print("ç®¡ç†è€…ãŒ admin_room ã«å‚åŠ ã—ã¾ã—ãŸ")

if __name__ == '__main__':
    socketio.run(app, host='0.0.0.0', port=8000)

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>  <!-- çµŒéæ™‚é–“è¡¨ç¤ºç”¨ -->

    <script>
        const socket = io();
        let startTime = null;
        let timerInterval = null;  // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_timer');
        });

        socket.on('timer_started', (serverTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);  
            startTime = serverTime;  // ãƒŸãƒªç§’å˜ä½ãªã®ã§ãã®ã¾ã¾åˆ©ç”¨
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;
        
            // **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«é–‹å§‹å‰ã«å³åº§ã«çµŒéæ™‚é–“ã‚’æ›´æ–°**
            updateElapsedTime();
        
            // 100msã”ã¨ã«çµŒéæ™‚é–“ã‚’æ›´æ–°
            timerInterval = setInterval(updateElapsedTime, 100);
        });
        
        // **ç¾åœ¨ã®çµŒéæ™‚é–“ã‚’å³åº§ã«æ›´æ–°ã™ã‚‹é–¢æ•°**
        function updateElapsedTime() {
            if (startTime === null) return;
            const elapsed = (Date.now() - startTime) / 1000;
            document.getElementById('elapsedTime').innerText = çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’;
        }


        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            const elapsed = (Date.now() - startTime) / 1000;  // çµŒéæ™‚é–“ã‚’ç§’å˜ä½ã§è¨ˆç®—
            
            socket.emit('submit_time', { user: user, time: elapsed });
            
            // ã€Œçµ‚ã‚ã‚Šï¼ã€ã¨è¡¨ç¤º
            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";

            // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
            if (timerInterval !== null) {
                clearInterval(timerInterval);  // æ­£ã—ãã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
                timerInterval = null;  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«IDã‚’ãƒªã‚»ãƒƒãƒˆ
            }

            document.getElementById('stopBtn').disabled = true;
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ç”»é¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        table {
            width: 50%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®çµæœ</h1>
    <table>
        <thead>
            <tr>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                <th>æ™‚é–“ (ç§’)</th>
                <th>èª¤å·® (ç§’)</th>
            </tr>
        </thead>
        <tbody id="resultsTable">
            <tr><td>A</td><td id="A-time">-</td><td id="A-diff">-</td></tr>
            <tr><td>B</td><td id="B-time">-</td><td id="B-diff">-</td></tr>
            <tr><td>C</td><td id="C-time">-</td><td id="C-diff">-</td></tr>
            <tr><td>D</td><td id="D-time">-</td><td id="D-diff">-</td></tr>
            <tr><td>E</td><td id="E-time">-</td><td id="E-diff">-</td></tr>
            <tr><td>F</td><td id="F-time">-</td><td id="F-diff">-</td></tr>
            <tr><td>G</td><td id="G-time">-</td><td id="G-diff">-</td></tr>
            <tr><td>H</td><td id="H-time">-</td><td id="H-diff">-</td></tr>
        </tbody>
    </table>

    <script>
        const socket = io();
        let currentResults = {}; // ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµæœã‚’ä¿æŒ
    
        socket.on('update_results', (results) => {
            console.log("æ›´æ–°ã•ã‚ŒãŸçµæœ:", results);  // ã“ã“ã§çµæœãŒå±Šã„ã¦ã„ã‚‹ã‹ç¢ºèª
            // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ currentResults ã«çµ±åˆ
            Object.assign(currentResults, results);
    
            for (const user of ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']) {
                const timeCell = document.getElementById(${user}-time);
                const diffCell = document.getElementById(${user}-diff);
    
                if (currentResults[user] !== undefined) {
                    const time = currentResults[user].toFixed(3);
                    const diff = Math.abs(10 - currentResults[user]).toFixed(3);
                    timeCell.textContent = time;
                    diffCell.textContent = diff;
                } else {
                    timeCell.textContent = "-";
                    diffCell.textContent = "-";
                }
            }
        });
    </script>
</body>
</html>

renderã‚’ä½¿ã£ã¦ã€8å°ã®ã‚¹ãƒãƒ›ã‚’åˆ©ç”¨ã—ã¦ã‚²ãƒ¼ãƒ ã‚’åŒæ™‚ã«ã‚¹ã‚¿ãƒ¼ãƒˆã•ã›ã€ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸçµæœã‚’adminã«ã™ã¹ã¦è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¦
ChatGPT:
ä»¥ä¸‹ã®ä¿®æ­£ã‚’åŠ ãˆã¾ã—ãŸã€‚

Renderã§ãƒ‡ãƒ—ãƒ­ã‚¤ - gevent ã¯ WSGI ã‚µãƒ¼ãƒãƒ¼ã¨ã®äº’æ›æ€§ãŒä½ã„ãŸã‚ã€eventlet ã‚’ä½¿ç”¨ã€‚
ã™ã¹ã¦ã®ã‚¹ãƒãƒ›ã§åŒæ™‚ã«é–‹å§‹ - start_timer ã‚¤ãƒ™ãƒ³ãƒˆã§ã€å…¨å“¡ã®ã‚¹ãƒãƒ›ã«åŒæœŸã•ã‚ŒãŸã‚¿ã‚¤ãƒãƒ¼ã‚’é€ä¿¡ã€‚
ã‚¹ãƒˆãƒƒãƒ—æ™‚ã®é€ä¿¡ã‚’æ˜ç¢ºåŒ– - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒˆãƒƒãƒ—ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ­£ã—ãç®¡ç†è€…ç”»é¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã€‚
Renderå¯¾å¿œ - requirements.txt ã®è¿½åŠ ã¨ web: gunicorn -k eventlet -w 1 app:app ã‚’è¨­å®šã€‚
ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¾ã—ãŸã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

Render 10sec Game
ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ app.py ã«ä¿å­˜ã—ã€Render ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚index.html ã¨ admin.html ã¯ãã®ã¾ã¾ä½¿ç”¨ã§ãã¾ã™ã€‚requirements.txt ã«ã¯ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

rust
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
Flask
flask-socketio
eventlet
gunicorn
Render ã® Web Service è¨­å®šã§ gunicorn -k eventlet -w 1 app:app ã‚’ä½¿ç”¨ã™ã‚Œã°ã€8å°ã®ã‚¹ãƒãƒ›ãŒåŒæ™‚ã«å‚åŠ ã—ã€çµæœãŒç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼






ã‚ãªãŸ:
ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’index.htmlã«è¡¨ç¤ºã™ã‚‹ã®ã§ã¯ãªãã€adminã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„
ä¿®æ­£ã—ã¦
ChatGPT:
1 ä»¶ã®ç·¨é›†ã‚’åŠ ãˆã¾ã—ãŸ
admin.html ã‹ã‚‰ start_timer ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã« admin_start_timer ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ç®¡ç†è€…ãŒãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚¿ã‚¤ãƒãƒ¼ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚admin.html ã« socket.emit('admin_start_timer') ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚






ã‚ãªãŸ:
admin.html ã« socket.emit('admin_start_timer')ã‚’è¿½åŠ ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚‚æ›¸ã„ã¦
ChatGPT:
ä»¥ä¸‹ã®ã‚ˆã†ã« admin.html ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚start_timer ãƒœã‚¿ãƒ³ã‚’ç®¡ç†è€…ç”»é¢ã«è¿½åŠ ã—ã€ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ socket.emit('admin_start_timer') ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

html
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ç”»é¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        table {
            width: 50%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        button {
            font-size: 1.2em;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®çµæœ</h1>
    
    <button id="startTimerBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    
    <table>
        <thead>
            <tr>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                <th>æ™‚é–“ (ç§’)</th>
                <th>èª¤å·® (ç§’)</th>
            </tr>
        </thead>
        <tbody id="resultsTable">
            <tr><td>A</td><td id="A-time">-</td><td id="A-diff">-</td></tr>
            <tr><td>B</td><td id="B-time">-</td><td id="B-diff">-</td></tr>
            <tr><td>C</td><td id="C-time">-</td><td id="C-diff">-</td></tr>
            <tr><td>D</td><td id="D-time">-</td><td id="D-diff">-</td></tr>
            <tr><td>E</td><td id="E-time">-</td><td id="E-diff">-</td></tr>
            <tr><td>F</td><td id="F-time">-</td><td id="F-diff">-</td></tr>
            <tr><td>G</td><td id="G-time">-</td><td id="G-diff">-</td></tr>
            <tr><td>H</td><td id="H-time">-</td><td id="H-diff">-</td></tr>
        </tbody>
    </table>

    <script>
        const socket = io();

        document.getElementById('startTimerBtn').addEventListener('click', () => {
            socket.emit('admin_start_timer');
        });

        socket.on('update_results', (results) => {
            console.log("æ›´æ–°ã•ã‚ŒãŸçµæœ:", results);
            
            for (const user of ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']) {
                const timeCell = document.getElementById(`${user}-time`);
                const diffCell = document.getElementById(`${user}-diff`);
    
                if (results[user] !== undefined) {
                    const time = results[user].toFixed(3);
                    const diff = Math.abs(10 - results[user]).toFixed(3);
                    timeCell.textContent = time;
                    diffCell.textContent = diff;
                } else {
                    timeCell.textContent = "-";
                    diffCell.textContent = "-";
                }
            }
        });
    </script>
</body>
</html>
å¤‰æ›´ç‚¹ï¼š
ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³è¿½åŠ 
id="startTimerBtn" ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã« socket.emit('admin_start_timer') ã‚’é€ä¿¡ã€‚
æ›´æ–°ã•ã‚ŒãŸçµæœã®è¡¨ç¤º
æ—¢å­˜ã® update_results ã‚¤ãƒ™ãƒ³ãƒˆã§ç®¡ç†è€…ã«æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ ã€‚
ã“ã‚Œã§ã€ç®¡ç†è€…ãŒ ã‚¹ã‚¿ãƒ¼ãƒˆ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å…¨å‚åŠ è€…ã®ã‚¹ãƒãƒ›ã§ã‚¿ã‚¤ãƒãƒ¼ãŒåŒæ™‚ã«ã‚¹ã‚¿ãƒ¼ãƒˆã—ã€ã‚¹ãƒˆãƒƒãƒ—ã—ãŸçµæœãŒç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼






ã‚ãªãŸ:
adminã§è¿”ã£ã¦ãã‚‹ç§’ãƒ‡ãƒ¼ã‚¿ã¨ã‚¹ãƒãƒ›ã«è¡¨ç¤ºã•ã‚Œã‚‹çµŒéæ™‚é–“ã®çµ‚ã‚ã‚Šæ™‚åˆ»ãŒé•ã†å€¤ã«ãªã£ã¦ã„ã‚‹
æ­£ã—ã„ç§’ã‚’è¨ˆæ¸¬ã—ã¦ã©ã¡ã‚‰ã‚‚è¡¨ç¤ºã—ã¦
ChatGPT:
ã“ã®ã‚ºãƒ¬ã®åŸå› ã¯ã€start_time ã®å‡¦ç†æ–¹æ³•ã«ã‚ã‚Šã¾ã™ã€‚ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€

start_time ã‚’ admin ã‹ã‚‰é€ä¿¡ã—ãŸç¬é–“ã®ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ã§è¨­å®š
å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (index.html) ã¯è‡ªåˆ†ã® Date.now() ã‚’åŸºæº–ã«è¨ˆç®—
ã“ã®æ–¹æ³•ã ã¨ã€é€šä¿¡é…å»¶ï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ã«ã‚ˆã‚Šã€ã‚¹ãƒãƒ›ã®ç”»é¢ã§è¡¨ç¤ºã•ã‚Œã‚‹çµŒéæ™‚é–“ã¨ admin ã§å—ã‘å–ã‚‹çµæœãŒã‚ºãƒ¬ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

è§£æ±ºç­–
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ stopBtn ã‚’æŠ¼ã—ãŸæ™‚ã® æ­£ç¢ºãªã‚µãƒ¼ãƒãƒ¼å´ã®æ™‚åˆ» ã‚’è¨ˆæ¸¬ã—ã¦é€ä¿¡ã™ã‚‹ã€‚
start_time ã‚‚ã‚µãƒ¼ãƒãƒ¼ã§çµ±ä¸€ç®¡ç†ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ç›¸å¯¾æ™‚é–“ã§ã¯ãªã ã‚µãƒ¼ãƒãƒ¼ã®åŸºæº–æ™‚åˆ»ã‹ã‚‰ã®ã‚ºãƒ¬ ã‚’è¨ˆæ¸¬ã™ã‚‹ã€‚
ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰
Flask (app.py) ã®ä¿®æ­£
ã‚µãƒ¼ãƒãƒ¼ã§ start_time ã‚’çµ±ä¸€ã—ã€å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ ã‚µãƒ¼ãƒãƒ¼å´ã®ç¾åœ¨æ™‚åˆ»ã¨ã®å·® ã‚’è¨ˆç®—ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã€‚

python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
import time
from flask import Flask, render_template
from flask_socketio import SocketIO, emit, join_room

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*", async_mode="gevent")

start_time = None  # ã‚µãƒ¼ãƒãƒ¼å´ã®çµ±ä¸€ã•ã‚ŒãŸé–‹å§‹æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
results = {}

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/admin')
def admin():
    return render_template('admin.html')

@socketio.on('admin_start_timer')
def admin_start_timer():
    global start_time, results
    start_time = int(time.time() * 1000)  # ãƒŸãƒªç§’å˜ä½ã§ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
    results = {}  # çµæœãƒªã‚»ãƒƒãƒˆ
    print(f"ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹: {start_time}")
    
    emit('timer_started', start_time, broadcast=True)  # å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€šçŸ¥

@socketio.on('submit_time')
def submit_time(data):
    global start_time
    user = data['user']
    client_press_time = data['time']

    server_current_time = int(time.time() * 1000)  # ã‚µãƒ¼ãƒãƒ¼å´ã®ç¾åœ¨æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
    server_elapsed_time = (server_current_time - start_time) / 1000  # ã‚µãƒ¼ãƒãƒ¼å´ã§è¨ˆç®—

    formatted_time = float("{:.3f}".format(server_elapsed_time))
    results[user] = {"client_time": client_press_time, "server_time": formatted_time}

    emit('update_results', results, room="admin_room")

@socketio.on('connect')
def handle_connect():
    join_room("admin_room")
    print("ç®¡ç†è€…ãŒ admin_room ã«å‚åŠ ã—ã¾ã—ãŸ")

if __name__ == '__main__':
    socketio.run(app, host='0.0.0.0', port=8000)
index.htmlï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰ã®ä¿®æ­£
ã‚¹ãƒãƒ›ã§è¡¨ç¤ºã™ã‚‹æ™‚é–“ã¯ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é€ã‚‰ã‚ŒãŸ start_time ã‚’åŸºæº– ã«è¨ˆæ¸¬ã—ã€é€ä¿¡ã™ã‚‹å€¤ã‚‚ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ã¨ã®å·®ã«å¤‰æ›´ã€‚

html
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>

    <script>
        const socket = io();
        let startTime = null;
        let timerInterval = null;

        socket.on('timer_started', (serverTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);
            startTime = serverTime;
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;

            updateElapsedTime();
            timerInterval = setInterval(updateElapsedTime, 100);
        });

        function updateElapsedTime() {
            if (startTime === null) return;
            const elapsed = (Date.now() - startTime) / 1000;
            document.getElementById('elapsedTime').innerText = `çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’`;
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            const elapsed = (Date.now() - startTime) / 1000;
            socket.emit('submit_time', { user: user, time: elapsed });

            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";
            if (timerInterval !== null) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            document.getElementById('stopBtn').disabled = true;
        });
    </script>
</body>
</html>
admin.html ã®ä¿®æ­£
ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¸¡æ–¹ã®æ™‚é–“ã‚’ç®¡ç†ç”»é¢ã«è¡¨ç¤ºã€‚

html
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<tbody id="resultsTable">
    <tr>
        <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
        <th>ã‚¹ãƒãƒ›ã®ç§’æ•°</th>
        <th>ã‚µãƒ¼ãƒãƒ¼è¨ˆæ¸¬ç§’æ•°</th>
        <th>ã‚µãƒ¼ãƒãƒ¼èª¤å·® (ç§’)</th>
    </tr>
    <tr><td>A</td><td id="A-client">-</td><td id="A-server">-</td><td id="A-diff">-</td></tr>
    ...
</tbody>
javascript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
socket.on('update_results', (results) => {
    console.log("æ›´æ–°ã•ã‚ŒãŸçµæœ:", results);

    for (const user in results) {
        const clientCell = document.getElementById(`${user}-client`);
        const serverCell = document.getElementById(`${user}-server`);
        const diffCell = document.getElementById(`${user}-diff`);

        const clientTime = results[user].client_time.toFixed(3);
        const serverTime = results[user].server_time.toFixed(3);
        const diff = Math.abs(10 - results[user].server_time).toFixed(3);

        clientCell.textContent = clientTime;
        serverCell.textContent = serverTime;
        diffCell.textContent = diff;
    }
});
çµæœ
ã‚¹ãƒãƒ›ã®è¡¨ç¤ºã¨ã‚µãƒ¼ãƒãƒ¼è¨ˆæ¸¬å€¤ãŒæƒã†
é€šä¿¡é…å»¶ãŒã‚ã£ã¦ã‚‚ã‚µãƒ¼ãƒãƒ¼åŸºæº–ã§çµ±ä¸€
admin.html ã«ã‚¹ãƒãƒ›ã®è¨ˆæ¸¬å€¤ã¨ã‚µãƒ¼ãƒãƒ¼è¨ˆæ¸¬å€¤ã‚’ä¸¡æ–¹è¡¨ç¤º
ã“ã®æ–¹æ³•ãªã‚‰ã€èª¤å·®ãŒæœ€å°é™ã«ãªã‚Šã€æ­£ç¢ºãªç§’æ•°ãŒå–å¾—ã§ãã¾ã™ï¼






ã‚ãªãŸ:
app.py
from flask import Flask, render_template
from flask_socketio import SocketIO, emit, join_room
import time

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*", async_mode="eventlet")

start_time = None  # ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹æ™‚é–“
results = {}  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµæœã‚’ä¿å­˜

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/admin')
def admin():
    return render_template('admin.html')

@socketio.on('start_timer')
def start_timer():
    global start_time, results
    start_time = int(time.time() * 1000)  # ãƒŸãƒªç§’å˜ä½
    results = {}  # çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
    emit('timer_started', start_time, broadcast=True)  # ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡

@socketio.on('submit_time')
def submit_time(data):
    user = data['user']
    press_time = data['time']
    results[user] = round(press_time, 3)
    emit('update_results', results, room="admin_room")

@socketio.on('connect')
def handle_connect():
    join_room("admin_room")
    emit('update_results', results, room="admin_room")

@socketio.on('admin_start_timer')
def admin_start_timer():
    start_timer()

if __name__ == '__main__':
    socketio.run(app, host='0.0.0.0', port=8000)

index.html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>  <!-- çµŒéæ™‚é–“è¡¨ç¤ºç”¨ -->

    <script>
        const socket = io();
        let startTime = null;
        let timerInterval = null;  // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_timer');
        });

        socket.on('timer_started', (serverTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);  
            startTime = serverTime;  // ãƒŸãƒªç§’å˜ä½ãªã®ã§ãã®ã¾ã¾åˆ©ç”¨
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;
        
            // **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«é–‹å§‹å‰ã«å³åº§ã«çµŒéæ™‚é–“ã‚’æ›´æ–°**
            updateElapsedTime();
        
            // 100msã”ã¨ã«çµŒéæ™‚é–“ã‚’æ›´æ–°
            timerInterval = setInterval(updateElapsedTime, 100);
        });
        
        // **ç¾åœ¨ã®çµŒéæ™‚é–“ã‚’å³åº§ã«æ›´æ–°ã™ã‚‹é–¢æ•°**
        function updateElapsedTime() {
            if (startTime === null) return;
            const elapsed = (Date.now() - startTime) / 1000;
            document.getElementById('elapsedTime').innerText = çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’;
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            const elapsed = (Date.now() - startTime) / 1000;  // çµŒéæ™‚é–“ã‚’ç§’å˜ä½ã§è¨ˆç®—
            
            socket.emit('submit_time', { user: user, time: elapsed });
            
            // ã€Œçµ‚ã‚ã‚Šï¼ã€ã¨è¡¨ç¤º
            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";

            // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
            if (timerInterval !== null) {
                clearInterval(timerInterval);  // æ­£ã—ãã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
                timerInterval = null;  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«IDã‚’ãƒªã‚»ãƒƒãƒˆ
            }

            document.getElementById('stopBtn').disabled = true;
        });
    </script>
</body>
</html>

admin.html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ç”»é¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        table {
            width: 50%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        button {
            font-size: 1.2em;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®çµæœ</h1>
    
    <button id="startTimerBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    
    <table>
        <thead>
            <tr>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                <th>æ™‚é–“ (ç§’)</th>
                <th>èª¤å·® (ç§’)</th>
            </tr>
        </thead>
        <tbody id="resultsTable">
            <tr><td>A</td><td id="A-time">-</td><td id="A-diff">-</td></tr>
            <tr><td>B</td><td id="B-time">-</td><td id="B-diff">-</td></tr>
            <tr><td>C</td><td id="C-time">-</td><td id="C-diff">-</td></tr>
            <tr><td>D</td><td id="D-time">-</td><td id="D-diff">-</td></tr>
            <tr><td>E</td><td id="E-time">-</td><td id="E-diff">-</td></tr>
            <tr><td>F</td><td id="F-time">-</td><td id="F-diff">-</td></tr>
            <tr><td>G</td><td id="G-time">-</td><td id="G-diff">-</td></tr>
            <tr><td>H</td><td id="H-time">-</td><td id="H-diff">-</td></tr>
        </tbody>
    </table>

    <script>
        const socket = io();

        document.getElementById('startTimerBtn').addEventListener('click', () => {
            socket.emit('admin_start_timer');
        });

        socket.on('update_results', (results) => {
            console.log("æ›´æ–°ã•ã‚ŒãŸçµæœ:", results);
            
            for (const user of ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']) {
                const timeCell = document.getElementById(${user}-time);
                const diffCell = document.getElementById(${user}-diff);
    
                if (results[user] !== undefined) {
                    const time = results[user].toFixed(3);
                    const diff = Math.abs(10 - results[user]).toFixed(3);
                    timeCell.textContent = time;
                    diffCell.textContent = diff;
                } else {
                    timeCell.textContent = "-";
                    diffCell.textContent = "-";
                }
            }
        });
    </script>
</body>
</html>

ã“ã‚Œã‚’ã‚‚ã¨ã«åŒã˜ã‚ˆã†ã«ä¿®æ­£ã—ã¦
ChatGPT:
ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ:

æ­£ç¢ºãªç§’æ•°ã®è¨ˆæ¸¬:

admin å´ã¨ ã‚¹ãƒãƒ› å´ã®ç§’æ•°ã‚’æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã« submit_time ã®ãƒ‡ãƒ¼ã‚¿ã« adminå´ã®ç§’æ•° ã‚’è¿½åŠ ã€‚
admin.html ã§ä¸¡æ–¹ã®ç§’æ•°ã‚’è¡¨ç¤ºã€‚
ä¸¡æ–¹ã®ç§’ã‚’è¨˜éŒ²:

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (index.html) å´ãŒè¨ˆæ¸¬ã—ãŸ elapsed ã¨ã€ã‚µãƒ¼ãƒãƒ¼ (app.py) å´ã§è¨ˆæ¸¬ã™ã‚‹ actual_elapsed ã®ä¸¡æ–¹ã‚’é€ä¿¡ã€‚
app.py ã®ä¿®æ­£
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
from flask import Flask, render_template
from flask_socketio import SocketIO, emit, join_room
import time

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*", async_mode="eventlet")

start_time = None  # ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹æ™‚é–“
results = {}  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµæœã‚’ä¿å­˜

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/admin')
def admin():
    return render_template('admin.html')

@socketio.on('start_timer')
def start_timer():
    global start_time, results
    start_time = int(time.time() * 1000)  # ãƒŸãƒªç§’å˜ä½
    results = {}  # çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
    emit('timer_started', start_time, broadcast=True)  # ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡

@socketio.on('submit_time')
def submit_time(data):
    global start_time
    user = data['user']
    client_elapsed = round(data['time'], 3)
    
    # ã‚µãƒ¼ãƒãƒ¼å´ã§è¨ˆæ¸¬ã™ã‚‹å®Ÿéš›ã®çµŒéæ™‚é–“
    server_elapsed = round((int(time.time() * 1000) - start_time) / 1000, 3)

    results[user] = {"client_time": client_elapsed, "server_time": server_elapsed}
    emit('update_results', results, room="admin_room")

@socketio.on('connect')
def handle_connect():
    join_room("admin_room")
    emit('update_results', results, room="admin_room")

@socketio.on('admin_start_timer')
def admin_start_timer():
    start_timer()

if __name__ == '__main__':
    socketio.run(app, host='0.0.0.0', port=8000)
admin.html ã®ä¿®æ­£
html
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<table>
    <thead>
        <tr>
            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
            <th>ã‚¹ãƒãƒ›è¨ˆæ¸¬ (ç§’)</th>
            <th>ã‚µãƒ¼ãƒãƒ¼è¨ˆæ¸¬ (ç§’)</th>
            <th>èª¤å·® (ç§’)</th>
        </tr>
    </thead>
    <tbody id="resultsTable">
        <tr><td>A</td><td id="A-client">-</td><td id="A-server">-</td><td id="A-diff">-</td></tr>
        <tr><td>B</td><td id="B-client">-</td><td id="B-server">-</td><td id="B-diff">-</td></tr>
        <tr><td>C</td><td id="C-client">-</td><td id="C-server">-</td><td id="C-diff">-</td></tr>
        <tr><td>D</td><td id="D-client">-</td><td id="D-server">-</td><td id="D-diff">-</td></tr>
        <tr><td>E</td><td id="E-client">-</td><td id="E-server">-</td><td id="E-diff">-</td></tr>
        <tr><td>F</td><td id="F-client">-</td><td id="F-server">-</td><td id="F-diff">-</td></tr>
        <tr><td>G</td><td id="G-client">-</td><td id="G-server">-</td><td id="G-diff">-</td></tr>
        <tr><td>H</td><td id="H-client">-</td><td id="H-server">-</td><td id="H-diff">-</td></tr>
    </tbody>
</table>

<script>
    socket.on('update_results', (results) => {
        console.log("æ›´æ–°ã•ã‚ŒãŸçµæœ:", results);
        
        for (const user of ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']) {
            const clientCell = document.getElementById(`${user}-client`);
            const serverCell = document.getElementById(`${user}-server`);
            const diffCell = document.getElementById(`${user}-diff`);

            if (results[user] !== undefined) {
                const clientTime = results[user].client_time.toFixed(3);
                const serverTime = results[user].server_time.toFixed(3);
                const diff = Math.abs(results[user].client_time - results[user].server_time).toFixed(3);

                clientCell.textContent = clientTime;
                serverCell.textContent = serverTime;
                diffCell.textContent = diff;
            } else {
                clientCell.textContent = "-";
                serverCell.textContent = "-";
                diffCell.textContent = "-";
            }
        }
    });
</script>
index.html ã®ä¿®æ­£
å¤‰æ›´ãªã—ï¼ˆãŸã ã—ã€ã‚¹ãƒãƒ›ã¨ã‚µãƒ¼ãƒãƒ¼ä¸¡æ–¹ã®ç§’æ•°ãŒ admin.html ã«é€ä¿¡ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸï¼‰ã€‚

å¤‰æ›´ç‚¹ã¾ã¨ã‚
âœ… ã‚¹ãƒãƒ›å´ã®ç§’æ•° (client_time) ã¨ ã‚µãƒ¼ãƒãƒ¼å´ã®ç§’æ•° (server_time) ã‚’ä¸¡æ–¹é€ä¿¡
âœ… èª¤å·®ã‚’ç®¡ç†è€…ç”»é¢ã«è¡¨ç¤º
âœ… WebSocket ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä¿®æ­£ã—ã¦ä¸¡æ–¹ã®ç§’æ•°ã‚’æ‰±ã†ã‚ˆã†ã«å¤‰æ›´

ã“ã‚Œã§ admin å´ã®ç§’ãƒ‡ãƒ¼ã‚¿ã¨ ã‚¹ãƒãƒ› ã®çµŒéæ™‚é–“ã‚’æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼






ã‚ãªãŸ:
ã“ã®ä¿®æ­£ã§ã¯ãªãã€
ã“ã®ã‚ºãƒ¬ã®åŸå› ã¯ã€start_time ã®å‡¦ç†æ–¹æ³•ã«ã‚ã‚Šã¾ã™ã€‚ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€

start_time ã‚’ admin ã‹ã‚‰é€ä¿¡ã—ãŸç¬é–“ã®ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ã§è¨­å®š
å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (index.html) ã¯è‡ªåˆ†ã® Date.now() ã‚’åŸºæº–ã«è¨ˆç®—
ã“ã®æ–¹æ³•ã ã¨ã€é€šä¿¡é…å»¶ï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ã«ã‚ˆã‚Šã€ã‚¹ãƒãƒ›ã®ç”»é¢ã§è¡¨ç¤ºã•ã‚Œã‚‹çµŒéæ™‚é–“ã¨ admin ã§å—ã‘å–ã‚‹çµæœãŒã‚ºãƒ¬ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

è§£æ±ºç­–
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ stopBtn ã‚’æŠ¼ã—ãŸæ™‚ã® æ­£ç¢ºãªã‚µãƒ¼ãƒãƒ¼å´ã®æ™‚åˆ» ã‚’è¨ˆæ¸¬ã—ã¦é€ä¿¡ã™ã‚‹ã€‚
start_time ã‚‚ã‚µãƒ¼ãƒãƒ¼ã§çµ±ä¸€ç®¡ç†ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ç›¸å¯¾æ™‚é–“ã§ã¯ãªã ã‚µãƒ¼ãƒãƒ¼ã®åŸºæº–æ™‚åˆ»ã‹ã‚‰ã®ã‚ºãƒ¬ ã‚’è¨ˆæ¸¬ã™ã‚‹ã€‚

ã“ã‚Œã§ä¿®æ­£ã—ã¦
ChatGPT:
ã‚ºãƒ¬ã‚’é˜²ããŸã‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

ã‚µãƒ¼ãƒãƒ¼ã§ start_time ã‚’ä¸€å…ƒç®¡ç†
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ start_timer ã‚’æŠ¼ã™ã¨ã€ã‚µãƒ¼ãƒãƒ¼ãŒçµ±ä¸€ã•ã‚ŒãŸ start_time ã‚’è¨­å®šã—ã€ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã‚’é€ä¿¡ã›ãšã€ã‚µãƒ¼ãƒãƒ¼å´ã§è¨ˆæ¸¬
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ stopBtn ã‚’æŠ¼ã™ã¨ã€ãã®æ™‚ç‚¹ã§ã‚µãƒ¼ãƒãƒ¼ã«ã€ŒæŠ¼ã—ãŸã€ã¨ã„ã†æƒ…å ±ã ã‘é€ã‚‹ã€‚
ã‚µãƒ¼ãƒãƒ¼ã¯å—ä¿¡æ™‚ã® time.time() ã‚’åŸºæº–ã«è¨ˆæ¸¬ã—ã€start_time ã¨ã®å·®ã‚’è¨ˆç®—ã™ã‚‹ã€‚
ã“ã®æ–¹æ³•ãªã‚‰ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ‡ãƒã‚¤ã‚¹ã”ã¨ã®æ™‚é–“ã®ã‚ºãƒ¬ã‚„é€šä¿¡é…å»¶ã®å½±éŸ¿ã‚’æœ€å°é™ã«ã§ãã¾ã™ã€‚
ä¿®æ­£å¾Œã® app.pyã€index.htmlã€admin.html ã‚’åæ˜ ã—ã¾ã™ã€‚

1 ä»¶ã®ç·¨é›†ã‚’åŠ ãˆã¾ã—ãŸ
app.py ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ (index.html ã¨ admin.html) ã®ä¿®æ­£ã‚‚è¡Œã„ã¾ã™ã€‚

1 ä»¶ã®ç·¨é›†ã‚’åŠ ãˆã¾ã—ãŸ
index.html ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã« admin.html ã®ä¿®æ­£ã‚’è¡Œã„ã¾ã™ã€‚

1 ä»¶ã®ç·¨é›†ã‚’åŠ ãˆã¾ã—ãŸ
admin.html ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
ã“ã‚Œã§ã€ã‚¿ã‚¤ãƒãƒ¼ã®é–‹å§‹ãƒ»è¨ˆæ¸¬ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§çµ±ä¸€ç®¡ç†ã—ã€é€šä¿¡é…å»¶ã«ã‚ˆã‚‹ã‚ºãƒ¬ã‚’é˜²ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚å‹•ä½œã‚’ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚






ã‚ãªãŸ:
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>  <!-- çµŒéæ™‚é–“è¡¨ç¤ºç”¨ -->

    <script>
        const socket = io();
        let startTime = null;
        let timerInterval = null;  // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_timer');
        });

        socket.on('timer_started', (serverTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);  
            startTime = serverTime * 1000;  // ç§’å˜ä½ãªã®ã§ãƒŸãƒªç§’ã«å¤‰æ›
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;
        
            // **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«é–‹å§‹å‰ã«å³åº§ã«çµŒéæ™‚é–“ã‚’æ›´æ–°**
            updateElapsedTime();
        
            // 100msã”ã¨ã«çµŒéæ™‚é–“ã‚’æ›´æ–°
            timerInterval = setInterval(updateElapsedTime, 100);
        });
        
        // **ç¾åœ¨ã®çµŒéæ™‚é–“ã‚’å³åº§ã«æ›´æ–°ã™ã‚‹é–¢æ•°**
        function updateElapsedTime() {
            if (startTime === null) return;
            const elapsed = (Date.now() - startTime) / 1000;
            document.getElementById('elapsedTime').innerText = çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’;
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            socket.emit('submit_time', { user: user });  // æ™‚é–“ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§è¨ˆæ¸¬
            
            // ã€Œçµ‚ã‚ã‚Šï¼ã€ã¨è¡¨ç¤º
            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";

            // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
            if (timerInterval !== null) {
                clearInterval(timerInterval);  // æ­£ã—ãã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
                timerInterval = null;  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«IDã‚’ãƒªã‚»ãƒƒãƒˆ
            }

            document.getElementById('stopBtn').disabled = true;
        });
    </script>
</body>
</html>

çµŒéæ™‚é–“ã®è¡¨ç¤ºã‚‚ã‚µãƒ¼ãƒãƒ¼å´ã®åŸºæº–ã‚’ã‚‚ã¨ã«è¨ˆæ¸¬ã—ã¦è¡¨ç¤ºã—ã¦
ãªãŠã€adminã§è¡¨ç¤ºã•ã‚Œã‚‹çµæœã¨åŒã˜çµæœãŒindex.htmlã«ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦
ChatGPT:
ä¿®æ­£ç‚¹:

çµŒéæ™‚é–“ã®è¡¨ç¤ºã‚’ã‚µãƒ¼ãƒãƒ¼å´ã®åŸºæº–ã«çµ±ä¸€

start_timer æ™‚ã« startTime ã‚’å—ä¿¡ã—ã€ãã‚Œã‚’åŸºæº–ã« Date.now() ã§è¨ˆæ¸¬ã€‚
stopBtn ã‚’æŠ¼ã—ãŸæ™‚ã‚‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®è¨ˆæ¸¬ã‚’ãªãã—ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®è¨ˆæ¸¬çµæœã‚’å—ã‘å–ã£ã¦è¡¨ç¤ºã€‚
admin.html ã®çµæœã‚’ index.html ã«åŒæœŸ

update_results ã‚¤ãƒ™ãƒ³ãƒˆã‚’ index.html ã«ã‚‚é©ç”¨ã—ã€è‡ªåˆ†ã®çµæœã‚’è¡¨ç¤ºã€‚
ä¿®æ­£å¾Œã® index.html
html
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>  <!-- çµŒéæ™‚é–“è¡¨ç¤ºç”¨ -->
    <p id="finalTime">ã‚ãªãŸã®çµæœ: - ç§’</p>  <!-- æœ€çµ‚çµæœè¡¨ç¤º -->

    <script>
        const socket = io();
        let startTime = null;
        let timerInterval = null;  // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_timer');
        });

        socket.on('timer_started', (serverTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);  
            startTime = serverTime;  // ã‚µãƒ¼ãƒãƒ¼åŸºæº–æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;

            // 100msã”ã¨ã«çµŒéæ™‚é–“ã‚’æ›´æ–°
            updateElapsedTime();
            timerInterval = setInterval(updateElapsedTime, 100);
        });

        function updateElapsedTime() {
            if (startTime === null) return;
            const elapsed = (Date.now() - startTime) / 1000;
            document.getElementById('elapsedTime').innerText = `çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’`;
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            socket.emit('submit_time', { user: user });

            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";

            if (timerInterval !== null) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            document.getElementById('stopBtn').disabled = true;
        });

        // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸçµæœã‚’è¡¨ç¤º
        socket.on('update_results', (results) => {
            const user = document.getElementById('userSelect').value;
            if (results[user] !== undefined) {
                document.getElementById('finalTime').innerText = `ã‚ãªãŸã®çµæœ: ${results[user].toFixed(3)} ç§’`;
            }
        });
    </script>
</body>
</html>
ä¿®æ­£å¾Œã® app.py
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
from flask import Flask, render_template
from flask_socketio import SocketIO, emit, join_room
import time

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*", async_mode="eventlet")

start_time = None  # ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
results = {}  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµæœã‚’ä¿å­˜

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/admin')
def admin():
    return render_template('admin.html')

@socketio.on('start_timer')
def start_timer():
    global start_time, results
    start_time = int(time.time() * 1000)  # ã‚µãƒ¼ãƒãƒ¼ã®æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
    results = {}  # çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
    emit('timer_started', start_time, broadcast=True)  # ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡

@socketio.on('submit_time')
def submit_time(data):
    global start_time
    user = data['user']
    press_time = int(time.time() * 1000)  # æŠ¼ã•ã‚ŒãŸæ™‚ã®ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰

    elapsed = (press_time - start_time) / 1000  # çµŒéæ™‚é–“ã‚’è¨ˆç®—ï¼ˆç§’å˜ä½ï¼‰
    results[user] = round(elapsed, 3)

    emit('update_results', results, broadcast=True)

@socketio.on('connect')
def handle_connect():
    join_room("admin_room")
    emit('update_results', results, room="admin_room")

@socketio.on('admin_start_timer')
def admin_start_timer():
    start_timer()

if __name__ == '__main__':
    socketio.run(app, host='0.0.0.0', port=8000)
å¤‰æ›´ç‚¹ã®ã¾ã¨ã‚
âœ… ã‚µãƒ¼ãƒãƒ¼å´ã® start_time ã‚’åŸºæº–ã«çµ±ä¸€
âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯ Date.now() ã‚’ä½¿ã£ã¦ç›¸å¯¾è¨ˆç®—ã™ã‚‹ã®ã§ã¯ãªãã€ã‚µãƒ¼ãƒãƒ¼ã®è¨ˆæ¸¬ã‚’ãã®ã¾ã¾è¡¨ç¤º
âœ… admin.html ã«è¡¨ç¤ºã•ã‚Œã‚‹çµæœã¨ index.html ã«è¡¨ç¤ºã•ã‚Œã‚‹çµæœãŒä¸€è‡´

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã®å½±éŸ¿ã‚’å—ã‘ãšã€ã™ã¹ã¦ã®ç«¯æœ«ã§æ­£ç¢ºãªç§’æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼ğŸ¯






ã‚ãªãŸ:
ã‚¹ãƒãƒ›ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹index.htmlã®çµŒéæ™‚é–“ã‚‚ã‚µãƒ¼ãƒãƒ¼åŸºæº–ã®è¨ˆæ¸¬ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã—ã¦
ChatGPT:
ã‚¹ãƒãƒ›ã® index.html ã§ã‚‚ ã‚µãƒ¼ãƒãƒ¼åŸºæº–ã®è¨ˆæ¸¬ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤º ã™ã‚‹ãŸã‚ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® Date.now() ã§ã¯ãªãã€ã‚µãƒ¼ãƒãƒ¼ã® time.time() ã‚’å®šæœŸçš„ã«å–å¾—ã—ã¦çµŒéæ™‚é–“ã‚’æ›´æ–° ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

ä¿®æ­£å†…å®¹
ã‚µãƒ¼ãƒãƒ¼å´ (app.py)

100ms ã”ã¨ã«ã‚µãƒ¼ãƒãƒ¼ã®ç¾åœ¨æ™‚åˆ»ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹ send_server_time ã‚’è¿½åŠ ã€‚
start_timer æ™‚ã«ã“ã®é€ä¿¡ã‚’é–‹å§‹ã—ã€submit_time ã§åœæ­¢ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ (index.html)

server_time_update ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ã—ã€ã‚µãƒ¼ãƒãƒ¼ã®æ™‚åˆ»ã‚’åŸºæº–ã«çµŒéæ™‚é–“ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤ºã€‚
ä¿®æ­£å¾Œã® app.py
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
from flask import Flask, render_template
from flask_socketio import SocketIO, emit, join_room
import time
import eventlet

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*", async_mode="eventlet")

start_time = None  # ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
results = {}  # å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµæœ
timer_running = False  # ã‚¿ã‚¤ãƒãƒ¼ã®å®Ÿè¡ŒçŠ¶æ…‹

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/admin')
def admin():
    return render_template('admin.html')

@socketio.on('start_timer')
def start_timer():
    global start_time, results, timer_running
    start_time = int(time.time() * 1000)  # ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
    results = {}  # çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
    timer_running = True  # ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹

    emit('timer_started', start_time, broadcast=True)  # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡
    socketio.start_background_task(send_server_time)  # ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ã®é€ä¿¡ã‚’é–‹å§‹

def send_server_time():
    while timer_running:
        current_time = int(time.time() * 1000)  # ç¾åœ¨æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
        socketio.emit('server_time_update', current_time, broadcast=True)
        eventlet.sleep(0.1)  # 100msã”ã¨ã«æ›´æ–°

@socketio.on('submit_time')
def submit_time(data):
    global timer_running
    user = data['user']
    press_time = int(time.time() * 1000)  # æŠ¼ã•ã‚ŒãŸæ™‚ã®ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰

    elapsed = (press_time - start_time) / 1000  # çµŒéæ™‚é–“ï¼ˆç§’ï¼‰
    results[user] = round(elapsed, 3)

    emit('update_results', results, broadcast=True)
    timer_running = False  # ã‚¿ã‚¤ãƒãƒ¼åœæ­¢

@socketio.on('connect')
def handle_connect():
    join_room("admin_room")
    emit('update_results', results, room="admin_room")

@socketio.on('admin_start_timer')
def admin_start_timer():
    start_timer()

if __name__ == '__main__':
    socketio.run(app, host='0.0.0.0', port=8000)
ä¿®æ­£å¾Œã® index.html
html
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>  <!-- çµŒéæ™‚é–“è¡¨ç¤º -->
    <p id="finalTime">ã‚ãªãŸã®çµæœ: - ç§’</p>  <!-- æœ€çµ‚çµæœè¡¨ç¤º -->

    <script>
        const socket = io();
        let startTime = null;
        let serverTime = null;

        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_timer');
        });

        socket.on('timer_started', (serverStartTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverStartTime);
            startTime = serverStartTime;  // ã‚µãƒ¼ãƒãƒ¼åŸºæº–æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;
        });

        socket.on('server_time_update', (currentServerTime) => {
            serverTime = currentServerTime;
            if (startTime !== null) {
                const elapsed = (serverTime - startTime) / 1000;
                document.getElementById('elapsedTime').innerText = `çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’`;
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            socket.emit('submit_time', { user: user });

            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";
            document.getElementById('stopBtn').disabled = true;
        });

        socket.on('update_results', (results) => {
            const user = document.getElementById('userSelect').value;
            if (results[user] !== undefined) {
                document.getElementById('finalTime').innerText = `ã‚ãªãŸã®çµæœ: ${results[user].toFixed(3)} ç§’`;
            }
        });
    </script>
</body>
</html>
å¤‰æ›´ç‚¹ã®ã¾ã¨ã‚
âœ… ã‚¹ãƒãƒ› (index.html) ã®çµŒéæ™‚é–“ã‚‚ã‚µãƒ¼ãƒãƒ¼ã®åŸºæº–æ™‚åˆ»ã§æ›´æ–°
âœ… ã‚µãƒ¼ãƒãƒ¼ãŒ 100ms ã”ã¨ã« server_time_update ã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã—ã€ã‚¹ãƒãƒ›ã§ã‚‚ã‚ºãƒ¬ãªãè¨ˆæ¸¬
âœ… admin.html ã¨ index.html ã®çµæœãŒå®Œå…¨ã«ä¸€è‡´

ã“ã®ä¿®æ­£ã§ã€ã‚¹ãƒãƒ›ã‚„ PC ã©ã“ã§è¦‹ã¦ã‚‚ å®Œå…¨ã«ã‚µãƒ¼ãƒãƒ¼åŸºæº–ã®çµŒéæ™‚é–“ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèª ã§ãã¾ã™ï¼âœ¨






ã‚ãªãŸ:
server=flask-10sec-game.onrender.com//socket.io/ client=127.0.0.1:53486 socket shutdown error: [Errno 9] Bad file descriptorserver=flask-10sec-game.onrender.com//socket.io/ client=127.0.0.1:46034 socket shutdown error: [Errno 9] Bad file descriptorserver=flask-10sec-game.onrender.com//socket.io/ client=127.0.0.1:53500 socket shutdown error: [Errno 9] Bad file descriptorTraceback (most recent call last):
ChatGPT:
ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€WebSocket æ¥ç¶šãŒé©åˆ‡ã«é–‰ã˜ã‚‰ã‚Œã¦ã„ãªã„ ã“ã¨ãŒåŸå› ã§ç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ã€Bad file descriptor ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã¯ã€ã‚½ã‚±ãƒƒãƒˆãŒã™ã§ã«é–‰ã˜ã‚‰ã‚Œã¦ã„ã‚‹ã®ã«æ“ä½œã‚’è©¦ã¿ã¦ã„ã‚‹ å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

è€ƒãˆã‚‰ã‚Œã‚‹åŸå› 
Renderï¼ˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç’°å¢ƒï¼‰ã® WebSocket ã‚µãƒãƒ¼ãƒˆãŒä¸å®Œå…¨

Render ã¯ WebSocket æ¥ç¶šã‚’å®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å ´åˆãŒã‚ã‚‹ ãŸã‚ã€åˆ‡æ–­æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
ã‚µãƒ¼ãƒãƒ¼ã® send_server_time() ãŒé©åˆ‡ã«åœæ­¢ã—ã¦ã„ãªã„

timer_running = False ã«ã—ã¦ã‚‚ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ (send_server_time) ãŒå‹•ãç¶šã‘ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ WebSocket ã®åˆ‡æ–­å‡¦ç†ãŒé©åˆ‡ã«è¡Œã‚ã‚Œã¦ã„ãªã„

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒé©åˆ‡ã« disconnect ã›ãšã€ã‚µãƒ¼ãƒãƒ¼ãŒ socket.shutdown() ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
è§£æ±ºç­–
âœ… 1. send_server_time() ã‚’é©åˆ‡ã«åœæ­¢ã™ã‚‹
ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ãŒ timer_running = False ã«ãªã£ã¦ã‚‚ãƒ«ãƒ¼ãƒ—ã‚’ç¶šã‘ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ send_server_time() ã‚’ç¢ºå®Ÿã«çµ‚äº†ã•ã›ã‚‹ ã‚ˆã†ä¿®æ­£ã€‚

ä¿®æ­£å¾Œã® app.py
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
def send_server_time():
    while timer_running:
        try:
            current_time = int(time.time() * 1000)  # ç¾åœ¨æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
            socketio.emit('server_time_update', current_time, broadcast=True)
            eventlet.sleep(0.1)  # 100msã”ã¨ã«æ›´æ–°
        except Exception as e:
            print(f"Error in send_server_time: {e}")
            break  # ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹
âœ… 2. WebSocket åˆ‡æ–­æ™‚ã®å‡¦ç†ã‚’è¿½åŠ 
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ãŸã¨ãã« disconnect ã™ã‚‹ ã‚ˆã†ã«ä¿®æ­£ã€‚

ä¿®æ­£å¾Œã® index.html
javascript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
window.addEventListener("beforeunload", () => {
    socket.disconnect();  // ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ãŸã‚‰ç¢ºå®Ÿã«åˆ‡æ–­
});
âœ… 3. Render ã® WebSocket ã‚µãƒãƒ¼ãƒˆã‚’ç¢ºèª
Render ã¯ WebSocket ã‚’å®Œå…¨ã«ã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€é•·æ™‚é–“ã® WebSocket æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚
å¯¾ç­–: WebSocket ã‚’ PING é€ä¿¡ã—ã¦ç¶­æŒã™ã‚‹

javascript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
setInterval(() => {
    socket.emit("ping");  // å®šæœŸçš„ã«Pingã‚’é€ã‚‹
}, 30000);
ã¾ã¨ã‚
ã“ã®ä¿®æ­£ã§ã€Bad file descriptor ã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿã‚’é˜²ã’ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
ç‰¹ã«ã€ã‚µãƒ¼ãƒãƒ¼å´ã® send_server_time() ã®åœæ­¢å‡¦ç† ãŒé‡è¦ã§ã™ã€‚
è©¦ã—ã¦ã¿ã¦ã€ã¾ã ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦è¿½åŠ ã®å¯¾ç­–ã‚’è€ƒãˆã¾ã—ã‚‡ã†ï¼ ğŸš€






ã‚ãªãŸ:
çµŒéæ™‚é–“ãŒè¡¨ç¤ºã•ã‚Œãªããªã£ãŸã€‚
ChatGPT:
çµŒéæ™‚é–“ãŒè¡¨ç¤ºã•ã‚Œãªããªã£ãŸåŸå› ã¯ã€server_time_update ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ­£ã—ãé€ä¿¡ã•ã‚Œã¦ã„ãªã„ã‹ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å—ã‘å–ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ‡ãƒãƒƒã‚°ï¼†ä¿®æ­£ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

âœ… 1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ä¿®æ­£
ç¾åœ¨ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é€ã‚‰ã‚Œã‚‹ server_time_update ã‚’å—ã‘å–ã‚‹ã‚³ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ã€ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

ä¿®æ­£å¾Œã® index.html
javascript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
const socket = io();
let startTime = null;

document.getElementById('startBtn').addEventListener('click', () => {
    socket.emit('start_timer');
});

socket.on('timer_started', (serverTime) => {
    console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);
    startTime = serverTime * 1000;  // ç§’å˜ä½ãªã®ã§ãƒŸãƒªç§’ã«å¤‰æ›
    document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
    document.getElementById('stopBtn').disabled = false;
    document.getElementById('startBtn').disabled = true;
});

// **ã‚µãƒ¼ãƒãƒ¼æ™‚é–“ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ä¿¡ã—ã¦çµŒéæ™‚é–“ã‚’æ›´æ–°**
socket.on('server_time_update', (serverTime) => {
    if (startTime === null) return;
    const elapsed = (serverTime - startTime) / 1000;
    document.getElementById('elapsedTime').innerText = `çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’`;
});

// ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
document.getElementById('stopBtn').addEventListener('click', () => {
    if (startTime === null) return;
    const user = document.getElementById('userSelect').value;
    socket.emit('submit_time', { user: user });

    document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";
    document.getElementById('stopBtn').disabled = true;
});
âœ… 2. ã‚µãƒ¼ãƒãƒ¼å´ã®ä¿®æ­£
ã‚µãƒ¼ãƒãƒ¼ãŒ server_time_update ã‚’å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

ä¿®æ­£å¾Œã® app.py
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
import time
import eventlet
from flask import Flask, render_template
from flask_socketio import SocketIO

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*")

start_time = None
timer_running = False

@socketio.on('start_timer')
def handle_start_timer():
    global start_time, timer_running
    start_time = int(time.time() * 1000)  # ãƒŸãƒªç§’å˜ä½ã®ã‚µãƒ¼ãƒãƒ¼æ™‚åˆ»
    timer_running = True
    socketio.emit('timer_started', start_time, broadcast=True)
    eventlet.spawn(send_server_time)  # éåŒæœŸã§ã‚µãƒ¼ãƒãƒ¼æ™‚é–“ã‚’é€ä¿¡é–‹å§‹

def send_server_time():
    while timer_running:
        try:
            current_time = int(time.time() * 1000)
            socketio.emit('server_time_update', current_time, broadcast=True)
            eventlet.sleep(0.1)  # 100msã”ã¨ã«æ›´æ–°
        except Exception as e:
            print(f"Error in send_server_time: {e}")
            break  # ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹

@socketio.on('submit_time')
def handle_submit_time(data):
    global timer_running
    timer_running = False  # ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
    socketio.emit('message', f"{data['user']} ã•ã‚“ã®çµæœã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚", broadcast=True)

if __name__ == '__main__':
    socketio.run(app, debug=True)
âœ… 3. ç¢ºèªã™ã¹ããƒã‚¤ãƒ³ãƒˆ
ã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°ã‚’ç¢ºèª

server_time_update ãŒé€ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
print(f"é€ä¿¡ä¸­: {current_time}") ã‚’ send_server_time() å†…ã«è¿½åŠ ã—ã¦ãƒ‡ãƒãƒƒã‚°
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12 â†’ Consoleï¼‰ã‚’ç¢ºèª

server_time_update ã®ãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
console.log("å—ä¿¡:", serverTime); ã‚’è¿½åŠ ã—ã¦ãƒ‡ãƒãƒƒã‚°
âœ… 4. ã¾ã¨ã‚
server_time_update ã®é€ä¿¡ãƒ»å—ä¿¡ãŒã§ãã¦ã„ãªã„ã¨çµŒéæ™‚é–“ãŒè¡¨ç¤ºã•ã‚Œãªã„
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚µãƒ¼ãƒãƒ¼æ™‚é–“ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ä¿¡ã™ã‚‹ã‚ˆã†ä¿®æ­£
send_server_time() ãŒç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚ˆã†ã‚µãƒ¼ãƒãƒ¼å´ã‚‚ä¿®æ­£
ã“ã‚Œã§ã‚¹ãƒãƒ›ã§ã‚‚ ã‚µãƒ¼ãƒãƒ¼åŸºæº–ã®çµŒéæ™‚é–“ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš ã§ã™ï¼
è©¦ã—ã¦ã¿ã¦ã€ã¾ã å•é¡ŒãŒã‚ã‚Œã°ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚ ğŸš€







GPT-4o. ã® Free ãƒ—ãƒ©ãƒ³ã®åˆ¶é™ã«åˆ°é”ã—ã¾ã—ãŸã€‚åˆ¶é™ãŒ 19:52 ä»¥é™ ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã¾ã§ã€å›ç­”ã§ã¯åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã¾ãŸã¯ [ChatGPT Plus]() ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚

æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ

Plus ã‚’å…¥æ‰‹




æ¤œç´¢

æ¨è«–



Render 10sec Game






å®Ÿè¡Œ


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        select, button {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        button {
            cursor: pointer;
            border: none;
            border-radius: 10px;
        }
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        p {
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>10ç§’ãƒ”ãƒƒã‚¿ãƒªã‚²ãƒ¼ãƒ </h1>
    <label for="userSelect">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:</label>
    <select id="userSelect">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
    </select>
    <br><br>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopBtn" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <p id="message"></p>
    <p id="elapsedTime">çµŒéæ™‚é–“: 00.00 ç§’</p>  <!-- çµŒéæ™‚é–“è¡¨ç¤ºç”¨ -->

    <script>
        const socket = io();
        let startTime = null;
        let timerInterval = null;  // ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_timer');
        });

        socket.on('timer_started', (serverTime) => {
            console.log("ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹:", serverTime);  
            startTime = serverTime * 1000;  // ç§’å˜ä½ãªã®ã§ãƒŸãƒªç§’ã«å¤‰æ›
            document.getElementById('message').innerText = "ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼";
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;
        
            // **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«é–‹å§‹å‰ã«å³åº§ã«çµŒéæ™‚é–“ã‚’æ›´æ–°**
            updateElapsedTime();
        
            // 100msã”ã¨ã«çµŒéæ™‚é–“ã‚’æ›´æ–°
            timerInterval = setInterval(updateElapsedTime, 100);
        });
        
        // **ç¾åœ¨ã®çµŒéæ™‚é–“ã‚’å³åº§ã«æ›´æ–°ã™ã‚‹é–¢æ•°**
        function updateElapsedTime() {
            if (startTime === null) return;
            const elapsed = (Date.now() - startTime) / 1000;
            document.getElementById('elapsedTime').innerText = `çµŒéæ™‚é–“: ${elapsed.toFixed(2)} ç§’`;
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (startTime === null) return;

            const user = document.getElementById('userSelect').value;
            socket.emit('submit_time', { user: user });  // æ™‚é–“ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§è¨ˆæ¸¬
            
            // ã€Œçµ‚ã‚ã‚Šï¼ã€ã¨è¡¨ç¤º
            document.getElementById('message').innerText = "çµ‚ã‚ã‚Šï¼";

            // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
            if (timerInterval !== null) {
                clearInterval(timerInterval);  // æ­£ã—ãã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
                timerInterval = null;  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«IDã‚’ãƒªã‚»ãƒƒãƒˆ
            }

            document.getElementById('stopBtn').disabled = true;
        });
    </script>
</body>
</html>


å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤ºä¸­ã§ã™
ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¾©å…ƒã—ã¦ç·¨é›†ã—ã¾ã™

ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™

æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã‚‹
